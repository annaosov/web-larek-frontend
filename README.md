# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Базовый код

### Класс EventEmitter
Реализует паттерн «Наблюдатель» и позволяет подписываться на события и уведомлять подписчиков
о наступлении события.
Методы:
- on установить обработчик на событие,
- emit инициировать событие с данными.

### Класс Component
Абстрактный класс для работы с DOM в дочерних компонентах
Методы:
- toggleClass переключить класс,
- setText установить текстовое содержимое,
- setDisabled сменить статус блокировки,
- setImage установить изображение с алтернативным текстом,
- render вернуть корневой DOM-элемент.

### Класс Api
Реализует взаимодействие с сервером, отправка и получение запросов.

### Класс Model
Базовая модель, чтобы можно было отличить ее от простых объектов с данными.
Метод emitChanges сообщает всем что модель поменялась.

## Компоненты модели данных (бизнес-логика)
### Класс CardItem
- добавляет num в карточку товара, чтобы пронумеровать список в корзине.

### Класс AppState
Хранит данные: 
- catalog, 
- форм contacts и order, 
- полного заказа со всеми необходимыми данными orderFull, 
- formErrors ошибки формы order,
- formContactsErrors ошибки формы contacts,
- basket наполнение корзины,
- preview.
Методы:
- setCatalog и setPreview получение массива карточек каталога и конкретной карточки для preview соответственно,
- setOrderField и setContactsField получение полей форм order и contacts,
- validateOrder и validateContacts проверка полей форм order и contacts,
- clearBasket очистка корзины после оформленного заказа,
- getTotal подсчет стоимости всех товаров в корзине,
- getAddedToBasket добавление товара в корзину,
- getDeletedFromBasket удаление товара из корзины.

## Компоненты представления
### Класс Page
Отвечает за то как выглядит стартовая и единственная страница.
Методы:
- counter показывает счетчик кол-ва товаров в корзине на иконке корзины,
- catalog показывает каталог товаров,
- locked блокирует прокрутку страницы, если открыта модалка, и разблокирует - если закрыта.

### Класс Card
Карточка товара с информацией, которая нужна для отображения во всех местах приложения(id, title, price)

### Класс CatalogItem
Добавлены image, description, category, чтобы отображать карточки товаров на главной странице.
Метод selected для того, чтобы дизейблить кнопку с отправкой товара в корзину, в случае, если товар уже есть в корзине или у него нет цены.

### Класс Basket
Отображение самой корзины в модальном окне.
- items показывает список товаров, добавленных в корзину. Если их нет выводит надпись об этом,
- selected дизейблит кнопку дальнейшего оформления заказа, если корзина пуста,
- total показывает сумму всех товаров в корзине.

### Класс Modal
Отображение модальных окон с методами открытия, закрытия и рендера данных.

### Класс Form
Отображение форм в модальных окнах с методами:
- изменения инпутов,
- выбора варианта с помощью кнопок,
- если поле не валидно, то дизейблится кнопка дальнейшего оформления заказов,
- вывода ошибок
- рендера данных(полей).

### Класс Success
Отображение модального окна с выводом успешного оформления заказа и суммы заказа.

### Класс Order
Представление формы оrder в модальном окне с полем для заполнения адреса и кнопками выбора формы оплаты.

### Класс Contacts
Представление формы сontacts в модальном окне с полями для заполнения e-mail и телефона.

## Описание событий
- items:changed изменились элементы каталога,
- card:select открыть карточку,
- formErrors:change изменилось состояние валидации формы order,
- formContactsErrors:change изменилось состояние валидации формы contacts,
- /^order\..*:change/ изменилось одно из полей формы order,
- /^contacts\..*:change/ изменилось одно из полей формы contacts,
- order:open Открыть форму заказа,
- contacts:open Открыть форму контактов,
- contacts:submit Отправлена форма заказа,
- basket:open Открыть корзину,
- basket:add Добавление товара в корзину,
- basket:delete Удаление товара из корзины,
- preview:changed Изменена открытая выбранная карточка,
- modal:open блокирует прокрутку страницы, если открыта модалка,
- modal:close разблокирует прокрутку страницы, если модалка закрыта,
- Получаем product list с сервера.

### Класс CardAPI
Реализует взаимодействие с сервером, отправка и получение данных.
Методы:
- getCardItem получает карточку товара с бэка по id,
- getCardList получает список карточек товара,
- orderProducts отправляет заказ со всей необходимой информацией на бэк.

## Ключевые типы данных
Данные карточки товара
interface ICard {
    id: string; //id
    title: string; // название товара
    description?: string; // описание товара
    image: string; // изображение товара
    category: string; // категория товара
    price: number | null; // цена товара
}

Поля формы оrder
interface IOrderForm {
    address: string; // адрес покупателя для доставки
    payment: string; // способ оплаты
}

Дополнительные данные для оформления заказа из корзины
interface IOrder extends IOrderForm {
    items: string[], // массив id товаров, добавленных в корзину
    total: number, // сумма заказа
}

Поля формы сontacts
interface IContactsForm {
    email: string; // email адрес покупателя
    phone: string; // телефон покупателя для связи с ним
}

Объединяет все поля, которые нужны для оформления заказа
interface IOrderFull extends IOrder, IContactsForm {}

type FormErrors = Partial<Record<keyof IOrderForm, string>>; // ошибки при валидации формы оrder

type FormContactsErrors = Partial<Record<keyof IContactsForm, string>>; // ошибки при валидации формы сontacts

Данные модели
interface IAppState {
    catalog: ICard[]; // все карточки товаров в каталоге
    basket: string[]; // товары в корзине
    preview: string | null; // карточка товара для preview
    order: IOrderForm | null; // данные из формы order
    contacts: IContactsForm | null; // данные из формы сontacts
    orderFull: IOrderFull | null; // все данные, которые нужны для оформления заказа
}

Данные возвращаемые с бэка, когда заказ оформлен
interface IOrderResult {
    id: string; // id заказа, например
}